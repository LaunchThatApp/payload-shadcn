{"version":3,"sources":["../src/shadcnPlugin.ts"],"sourcesContent":["import fs from \"fs\";\nimport path from \"path\";\nimport { type Config } from \"payload\";\n\n// We'll define a simplified type for AdminViewComponent\n// since we can't import it from payload/config\ntype AdminViewComponent = React.ComponentType<any>;\n\nexport interface ShadcnPluginOptions {\n  /**\n   * Enable or disable the plugin\n   * @default true\n   */\n  enabled?: boolean;\n\n  /**\n   * Enable all shadcn component overrides\n   * This will override all supported views and components with shadcn versions\n   * @default false\n   */\n  enableAll?: boolean;\n\n  /**\n   * Configure which collections should use the shadcn list view\n   * If enableAll is true, this is ignored and all collections will use shadcn list view\n   * @example [\"posts\", \"users\"]\n   * @default []\n   */\n  listView?: {\n    collections: string[];\n  };\n\n  /**\n   * Configure which collections should use the shadcn edit view\n   * If enableAll is true, this is ignored and all collections will use shadcn edit view\n   * @example [\"posts\", \"users\"]\n   * @default []\n   */\n  editView?: {\n    collections: string[];\n  };\n\n  /**\n   * Additional CSS to inject into the admin panel\n   * This will be injected via a style tag in the beforeDashboard component\n   * @default \"\"\n   */\n  customCSS?: string;\n\n  /**\n   * Path to the custom.scss file where styles should be imported\n   * @example \"app/(payload)/custom.scss\"\n   */\n  customScssPath?: string;\n\n  /**\n   * Whether to automatically inject the shadcn styles import into custom.scss\n   * @default true\n   */\n  injectStyles?: boolean;\n}\n\n/**\n * Injects the shadcn styles import into the custom.scss file\n */\nconst injectStylesImport = (customScssPath: string) => {\n  try {\n    // Ensure the directory exists\n    const dir = path.dirname(customScssPath);\n    if (!fs.existsSync(dir)) {\n      fs.mkdirSync(dir, { recursive: true });\n    }\n\n    // The import statement to add\n    const importStatement =\n      '@import \"@launchthat.apps/payload-shadcn/globals.css\";';\n\n    // Read existing content or create new file\n    let content = \"\";\n    if (fs.existsSync(customScssPath)) {\n      content = fs.readFileSync(customScssPath, \"utf-8\");\n      // Check if import already exists\n      if (content.includes(importStatement)) {\n        return;\n      }\n    }\n\n    // Add import at the beginning of the file\n    const newContent = `${importStatement}\\n${content}`;\n    fs.writeFileSync(customScssPath, newContent);\n\n    console.log(\n      `✨ Successfully injected shadcn styles import into ${customScssPath}`,\n    );\n  } catch (error) {\n    console.error(`Error injecting styles import: ${error}`);\n  }\n};\n\n/**\n * PayloadCMS Shadcn UI Plugin\n * Replaces default PayloadCMS components with shadcn UI components\n */\nexport const shadcnPlugin =\n  (options: ShadcnPluginOptions = {}) =>\n  (incomingConfig: Config): Config => {\n    // Set defaults\n    const opts: Required<ShadcnPluginOptions> = {\n      enabled: options.enabled ?? true,\n      enableAll: options.enableAll ?? false,\n      listView: {\n        collections: options.listView?.collections ?? [],\n      },\n      editView: {\n        collections: options.editView?.collections ?? [],\n      },\n      customCSS: options.customCSS ?? \"\",\n      customScssPath: options.customScssPath ?? \"app/(payload)/custom.scss\",\n      injectStyles: options.injectStyles ?? true,\n    };\n\n    // If plugin is disabled, return unmodified config\n    if (!opts.enabled) return incomingConfig;\n\n    // Inject styles if enabled\n    if (opts.injectStyles && opts.customScssPath) {\n      injectStylesImport(opts.customScssPath);\n    }\n\n    // Clone the config to avoid mutating the original\n    const config = {\n      ...incomingConfig,\n      collections: [...(incomingConfig.collections || [])],\n      admin: {\n        ...(incomingConfig.admin || {}),\n        components: {\n          ...(incomingConfig.admin?.components || {}),\n        },\n      },\n    };\n\n    // Loop through all collections and modify their admin configuration\n    if (config.collections && Array.isArray(config.collections)) {\n      config.collections = config.collections.map((collection) => {\n        // Skip if collection has no slug\n        if (!collection.slug) return collection;\n\n        // Determine if this collection should use shadcn components\n        const shouldUseListView =\n          opts.enableAll || opts.listView.collections.includes(collection.slug);\n\n        // If no views should be overridden for this collection, return it unchanged\n        if (!shouldUseListView) return collection;\n\n        return {\n          ...collection,\n          admin: {\n            ...collection.admin,\n            components: {\n              ...collection.admin?.components,\n              views: {\n                ...collection.admin?.components?.views,\n                ...(shouldUseListView && {\n                  list: {\n                    Component: \"@launchthat.apps/payload-shadcn/rsc#ListView\",\n                  },\n                }),\n              },\n            },\n          },\n        };\n      });\n    }\n\n    // Set up onInit hook to log plugin initialization\n    const existingOnInit = config.onInit;\n    config.onInit = async (payload) => {\n      // Call existing onInit if it exists\n      if (existingOnInit) {\n        await existingOnInit(payload);\n      }\n\n      // Log which features are enabled\n      if (opts.enableAll) {\n        payload.logger.info(\n          \"✨ Payload Shadcn UI Plugin: All components enabled\",\n        );\n      } else {\n        if (opts.listView.collections.length > 0) {\n          payload.logger.info(\n            `✨ Payload Shadcn UI Plugin: List view enabled for collections: ${opts.listView.collections.join(\", \")}`,\n          );\n        }\n        if (opts.editView.collections.length > 0) {\n          payload.logger.info(\n            `✨ Payload Shadcn UI Plugin: Edit view enabled for collections: ${opts.editView.collections.join(\", \")}`,\n          );\n        }\n      }\n    };\n\n    return config;\n  };\n\nexport default shadcnPlugin;\n"],"names":["fs","path","injectStylesImport","customScssPath","dir","dirname","existsSync","mkdirSync","recursive","importStatement","content","readFileSync","includes","newContent","writeFileSync","console","log","error","shadcnPlugin","options","incomingConfig","opts","enabled","enableAll","listView","collections","editView","customCSS","injectStyles","config","admin","components","Array","isArray","map","collection","slug","shouldUseListView","views","list","Component","existingOnInit","onInit","payload","logger","info","length","join"],"mappings":"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"}